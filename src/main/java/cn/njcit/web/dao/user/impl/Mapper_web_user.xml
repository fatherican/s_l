<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.njcit.web.dao.user.WebUserDao">


    <!--&lt;!&ndash;获得基本用户的信息&ndash;&gt;-->
    <!--<select id="getUser" parameterType="cn.njcit.domain.user.User" resultType="cn.njcit.domain.user.User" >-->



    <!--</select>-->

    <!--&lt;!&ndash;获得教师的信息&ndash;&gt;-->
    <!--<select id="getTeacher" parameterType="cn.njcit.domain.user.User"  resultType="cn.njcit.domain.user.User">-->
        <!--select t.teacher_id userId,t.teacher_name name,t.teacher_work_num userNo,-->
               <!--t.colleage_id colleageId,t.role role-->
        <!--from  tb_teacher as t-->
        <!--where 1=1-->
        <!--<if test="userId!=null and userId!=''">-->
          <!--and  t.teacher_id=#{userId}-->
        <!--</if>-->
        <!--<if test="name!=null and name!=''">-->
            <!--and t.teacher_name=#{name}-->
        <!--</if>-->
        <!--<if test="userNo!=null and userNo!=''">-->
            <!--and t.teacher_work_num=#{userNo}-->
        <!--</if>-->
        <!--<if test="password!=null and password!=''">-->
            <!--and t.password=#{password}-->
        <!--</if>-->


    <!--</select>-->

    <!--&lt;!&ndash;获得学生的信息&ndash;&gt;-->
    <!--<select id="getStudent"  parameterType="cn.njcit.domain.user.User"   resultType="cn.njcit.domain.user.User">-->
        <!--select t.student_id userId,t.student_num userNo,t.student_name name,-->
               <!--t.colleage_id colleageId,t.professional_id professionalId,t.class_id classId-->
        <!--from  tb_student as t-->
        <!--where 1=1-->
        <!--<if test="userId!=null and userId!=''">-->
            <!--and  t.student_id=#{userId}-->
        <!--</if>-->
        <!--<if test="userNo!=null and userNo!=''">-->
            <!--and  t.student_num=#{userNo}-->
        <!--</if>-->
        <!--<if test="password!=null and password!=''">-->
            <!--and t.password=#{password}-->
        <!--</if>-->
        <!--<if test="name!=null and name!=''">-->
            <!--and  t.student_name=#{name}-->
        <!--</if>-->
    <!--</select>-->
    <!--<select id="getClassesByTeacherId" parameterType="map" resultType="java.util.Map">-->
        <!--select tc.class_id,tc.class_name-->
        <!--from tb_teacher tt left join tb_teacher_managed_class tmc on tt.teacher_id=tmc.teacher_id left join tb_class tc on tmc.class_id=tc.class_id-->
        <!--where tt.teacher_id=#{teacherId}-->
    <!--</select>-->
    <!--<select id="getClassesByColleageId" parameterType="map" resultType="java.util.Map">-->
        <!--select class_id,class_name-->
        <!--from tb_class-->
        <!--where colleage_id=#{colleageId}-->
    <!--</select>-->


    <select id="login" resultType="cn.njcit.domain.user.User" parameterType="cn.njcit.web.controller.user.UserQueryForm">
        select tb.teacher_id userId,tb.teacher_work_num userNo,tb.teacher_name name,
               tb.role role ,tb.colleage_id colleageId,tb.password password
        from tb_teacher tb
        where tb.teacher_work_num=#{userNo} and tb.password=#{password}
    </select>
    <select id="queryStudentList" parameterType="cn.njcit.web.controller.user.UserQueryForm" resultType="cn.njcit.domain.user.User">
        select  student_id userId,
                student_num userNo,
                student_name   name ,
                colleage_id   colleageId,
                colleage_name    colleageName,
                class_id    classId,
                class_name   className
         from tb_student
        where 1=1
        <include refid="queryStudentWhereStateMent"/>
        <if test="orderByName!=null and orderByName!=''">
            order by ${orderByName} ${orderByOrder}
        </if>
        limit #{start},#{length}
    </select>
    <select id="queryStudentCount" parameterType="cn.njcit.web.controller.user.UserQueryForm"  resultType="java.lang.Integer">
        select count(1)
        from tb_student
        where 1=1
        <include refid="queryStudentWhereStateMent"/>
    </select>


    <sql id="queryStudentWhereStateMent">
        <if test="managedClassList!=null">
            and class_id in
            <foreach item="item" collection="managedClassList" separator="," open="(" close=")" index="">
                #{item.class_id}
            </foreach>
        </if>
        <if test="colleageId!=null and colleageId!=''">
            and colleage_id =#{colleageId}
        </if>
    </sql>

    <!--更新密码-->
    <update id="updatePassword" parameterType="cn.njcit.web.controller.user.UserQueryForm">
        update  tb_teacher
        set password=#{password}
        where teacher_id=#{userId}
    </update>
    <update id="resetStudentPassword" parameterType="cn.njcit.domain.user.User">
        update tb_student
        set password=#{password}
        where student_id=#{userId}
    </update>
</mapper>